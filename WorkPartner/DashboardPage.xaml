<UserControl x:Class="WorkPartner.DashboardPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:WorkPartner"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="900" Loaded="Window_Loaded" IsVisibleChanged="DashboardPage_IsVisibleChanged">
    <Grid Background="White">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="3*"/>
        </Grid.ColumnDefinitions>

        <!-- Left Panel -->
        <Border Grid.Column="0" BorderBrush="Gainsboro" BorderThickness="0,0,1,0" Padding="15">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <GroupBox Header="과목 관리" Grid.Row="0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox x:Name="TaskInput" Grid.Column="0" Margin="0,0,5,0" KeyDown="TaskInput_KeyDown"/>
                        <Button Content="추가" Grid.Column="1" Click="AddTaskButton_Click" Margin="0,0,5,0"/>
                        <Button Content="수정" Grid.Column="2" Click="EditTaskButton_Click" Margin="0,0,5,0"/>
                        <Button Content="삭제" Grid.Column="3" Click="DeleteTaskButton_Click"/>
                    </Grid>
                </GroupBox>

                <ListBox x:Name="TaskListBox" Grid.Row="1" ItemsSource="{Binding TaskItems}" Margin="5,10,5,5" SelectionChanged="TaskListBox_SelectionChanged" MaxHeight="150">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Text}"/>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <GroupBox Header="할 일 목록" Grid.Row="2" Margin="0,10,0,0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <DockPanel Grid.Row="0" Margin="0,0,0,5">
                            <Button Content="&lt;" Click="TodoPrevDayButton_Click" DockPanel.Dock="Left"/>
                            <Button Content="&gt;" Click="TodoNextDayButton_Click" DockPanel.Dock="Right"/>
                            <DatePicker x:Name="TodoDatePicker" SelectedDateChanged="TodoDatePicker_SelectedDateChanged" HorizontalAlignment="Center"/>
                        </DockPanel>
                        <TreeView x:Name="TodoTreeView" Grid.Row="1" ItemsSource="{Binding FilteredTodoItems}">
                            <!-- TreeView setup remains the same -->
                        </TreeView>
                        <Grid Grid.Row="2" Margin="0,5,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox x:Name="TodoInput" KeyDown="TodoInput_KeyDown"/>
                            <Button Content="추가" Grid.Column="1" Click="AddTodoButton_Click" Margin="5,0,0,0"/>
                            <Button Content="삭제" Grid.Column="2" Click="DeleteTodoButton_Click" Margin="5,0,0,0"/>
                        </Grid>
                        <ItemsControl x:Name="SuggestedTagsItemsControl" Grid.Row="3" ItemsSource="{Binding SuggestedTags}" Margin="0,5,0,0">
                            <!-- ItemsControl setup remains the same -->
                        </ItemsControl>
                    </Grid>
                </GroupBox>
            </Grid>
        </Border>

        <!-- Right Panel -->
        <ScrollViewer Grid.Column="1" VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="15">
                <GroupBox Header="내 정보" Margin="0,0,0,10">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="150"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <local:CharacterDisplay x:Name="DashboardCharacterDisplay" Grid.Column="0"/>
                        <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="15,0,0,0">
                            <TextBlock x:Name="NicknameTextBlock" Text="닉네임" FontSize="18" FontWeight="Bold"/>
                            <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                <TextBlock x:Name="LevelTextBlock" Text="Lv. 1" FontWeight="SemiBold"/>
                                <TextBlock x:Name="ExpTextBlock" Text="(EXP: 150 / 200)" Margin="10,0,0,0" Foreground="Gray"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                <Image Source="/coin.png" Width="16" Height="16" VerticalAlignment="Center"/>
                                <TextBlock x:Name="CoinDisplayTextBlock" Text="1,000" FontWeight="SemiBold" VerticalAlignment="Center" Margin="5,0,0,0"/>
                            </StackPanel>
                            <TextBlock x:Name="CurrentTaskInfoTextBlock" Text="현재 작업: -" Margin="0,5,0,0" FontStyle="Italic"/>
                            <Button Content="아바타 꾸미기" Click="AvatarButton_Click" Margin="0,15,0,0" HorizontalAlignment="Left"/>
                        </StackPanel>
                    </Grid>
                </GroupBox>

                <Border Background="#F5F5F5" CornerRadius="10" Padding="20" Margin="0,0,0,10">
                    <StackPanel>
                        <TextBlock Text="오늘의 총 학습 시간" HorizontalAlignment="Center" FontSize="14" Foreground="Gray"/>
                        <TextBlock x:Name="MainTimeDisplay" Text="00:00:00" FontSize="56" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,5,0,10"/>
                        <TextBlock x:Name="CurrentTaskDisplay" Text="선택된 과목 없음" HorizontalAlignment="Center" FontSize="14"/>
                        <TextBlock x:Name="ActiveProcessDisplay" Text="활성: -" HorizontalAlignment="Center" FontSize="12" Foreground="Gray" Margin="0,5,0,0"/>
                        <TextBlock x:Name="SelectedTaskTotalTimeDisplay" Text="선택 과목 총계: 00:00:00" HorizontalAlignment="Center" FontSize="12" Margin="0,5,0,0"/>
                        <TextBlock x:Name="AiSuggestionTextBlock" HorizontalAlignment="Center" FontSize="12" Foreground="DodgerBlue" Margin="0,10,0,0"/>
                    </StackPanel>
                </Border>

                <GroupBox Header="타임라인" Margin="0,0,0,10">
                    <StackPanel>
                        <DockPanel Margin="5">
                            <Button Content="&lt;" DockPanel.Dock="Left" Click="PrevDayButton_Click" Padding="8,2"/>
                            <Button Content="&gt;" DockPanel.Dock="Right" Click="NextDayButton_Click" Padding="8,2"/>
                            <Button Content="오늘" DockPanel.Dock="Right" Click="TodayButton_Click" Margin="5,0"/>
                            <DatePicker x:Name="TimelineDatePicker" SelectedDateChanged="TimelineDatePicker_SelectedDateChanged" HorizontalAlignment="Center"/>
                        </DockPanel>
                        <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled" Height="300">
                            <StackPanel x:Name="TimeTableContainer" Margin="5"/>
                        </ScrollViewer>
                    </StackPanel>
                </GroupBox>

                <GroupBox Header="학습 보조 기능" Margin="0,0,0,10">
                    <StackPanel>
                        <StackPanel x:Name="SessionReviewPanel" Orientation="Vertical" HorizontalAlignment="Center" Visibility="Collapsed" Margin="0,10,0,0">
                            <TextBlock Text="방금 세션은 어땠나요? (1: 나쁨, 5: 좋음)" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                            <StackPanel Orientation="Horizontal">
                                <Button Content="1" Tag="1" Margin="2" Click="RateSessionButton_Click"/>
                                <Button Content="2" Tag="2" Margin="2" Click="RateSessionButton_Click"/>
                                <Button Content="3" Tag="3" Margin="2" Click="RateSessionButton_Click"/>
                                <Button Content="4" Tag="4" Margin="2" Click="RateSessionButton_Click"/>
                                <Button Content="5" Tag="5" Margin="2" Click="RateSessionButton_Click"/>
                            </StackPanel>
                        </StackPanel>
                        <WrapPanel HorizontalAlignment="Center" Margin="0,10,0,0">
                            <Button x:Name="FocusModeButton" Content="집중 모드" Click="FocusModeButton_Click" Margin="5"/>
                            <Button Content="수동 기록 추가" Click="AddManualLogButton_Click" Margin="5"/>
                            <Button Content="메모장" Click="MemoButton_Click" Margin="5"/>
                        </WrapPanel>
                    </StackPanel>
                </GroupBox>

                <GroupBox Header="앰비언트 사운드" Margin="0,0,0,10">
                    <StackPanel Margin="5">
                        <Grid Margin="0,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="60"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="파도" VerticalAlignment="Center"/>
                            <Slider x:Name="WaveSlider" Grid.Column="1" Minimum="0" Maximum="100" Value="0" ValueChanged="AmbientSound_ValueChanged"/>
                        </Grid>
                        <Grid Margin="0,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="60"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="숲" VerticalAlignment="Center"/>
                            <Slider x:Name="ForestSlider" Grid.Column="1" Minimum="0" Maximum="100" Value="0" ValueChanged="AmbientSound_ValueChanged"/>
                        </Grid>
                        <Grid Margin="0,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="60"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="비" VerticalAlignment="Center"/>
                            <Slider x:Name="RainSlider" Grid.Column="1" Minimum="0" Maximum="100" Value="0" ValueChanged="AmbientSound_ValueChanged"/>
                        </Grid>
                        <Grid Margin="0,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="60"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="모닥불" VerticalAlignment="Center"/>
                            <Slider x:Name="BonfireSlider" Grid.Column="1" Minimum="0" Maximum="100" Value="0" ValueChanged="AmbientSound_ValueChanged"/>
                        </Grid>
                    </StackPanel>
                </GroupBox>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>

